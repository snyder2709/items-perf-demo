# Запуск проекта через Docker
Данный проект запускается полностью в контейнерах с помощью **Docker Compose** и включает три сервиса:
* PostgreSQL
* Backend (NestJS)
* Frontend (Vue)

## Быстрый запуск
В корне проекта выполните:

```bash
docker compose up --build
```

После успешного запуска будут доступны:

* Frontend: [http://localhost:5173](http://localhost:5173)
* Backend API: [http://localhost:3000/api](http://localhost:3000/api)
* PostgreSQL: localhost:5432
---

## Инициализация базы данных

Все SQL-скрипты из директории: backend/infra/postgres/ - автоматически выполняются при первом запуске контейнера PostgreSQL.

Переменная окружения SEED_TARGET_ITEMS - колличество генерируемых записей для заполнения бд.
backend/.env/

Текущее колличество заполнения SEED_TARGET_ITEMS = 100 000


# Нагрузочное тестирование эндпоинта

## Общая цель
Данное тестирование направлено на проверку производительности эндпоинта получения списка `items`
при высокой частоте запросов и анализ эффективности проведённых оптимизаций.

---

## Внесённые оптимизации
- Переход с offset-пагинации на cursor-based пагинацию
- Кэширование результатов запросов на уровне сервера
- Оптимизация структуры запроса к базе данных
- Добавлена пакетная отправка запросов с фронтенда
- Использование пула подключений к базе данных с ограничением до 50 соединений

> ### Ограничение режима `batch`
> В режиме **batch** запросы выполняются параллельно, поэтому график времени
> _не отражает реальную нагрузку_ и может вводить в заблуждение. График показывает
> время всего пула запросов, а не время выполнения конкретного запроса.
> Корректно отражается только итоговое время выполнения (`totalDuration`).
> **Примечание:** Требуется доработка логики измерений и визуализации.

### Результат оптимизаций
Метрики одного запуска, где 10 запросов с одинаковыми параметрами:

| Метод              | Общее время | Итог                          |
|-------------------|------------|-------------------------------|
| Пакетный вызов     | **98 ms**  | Самый эффективный             |
| Поочерёдный вызов  | **137 ms** | В среднем медленнее на ~20%   |

На уровне ощущений:
- После оптимизации добавления параллельных вызовов итоговое время прогона сильно сократилось

---

## Инструкция по использованию страницы нагрузочного теста

### Настройка параметров нагрузки
На странице тестирования доступна форма, позволяющая управлять параметрами нагрузки на сервер:

- **Лимит записей** – количество элементов, которые будут получены в каждом запросе.
- **Offset** – смещение для пагинации с использованием offset (только для типа Offset).
- **Cursor** – начальный идентификатор для пагинации с использованием курсора (только для типа Cursor).
- **Increment (шаг)** – величина сдвига курсора или offset после каждого запроса. Шаг влияет на количество необходимых запросов.
- **Тип запроса** – выбирается между Offset pagination и Cursor pagination.
- **Кол-во запросов** – сколько запросов будет отправлено в рамках одного теста. Значение автоматически ограничивается исходя из выбранного шага и общего количества элементов.
- **Кэширование** – включение или отключение использования кэша при запросах.
- **pollType** – режим отправки запросов: _batch_ (пакетно, параллельно) или _sequence_ (поочерёдно, с задержкой).

⚠ **Примечания:**
- Если курсор превышает максимальный `id` в таблице, запросы будут возвращать пустой результат.
- После изменения шага (Increment) поле **Количество запросов** автоматически пересчитывается, чтобы суммарный сдвиг не выходил за предел таблицы.
- Поле **Количество запросов** не может быть меньше 1.

---

### Отображение метрик
Ниже формы располагается график, отображающий динамику времени выполнения запросов.

#### Типы собираемых метрик
- **Время выполнения запроса к базе данных**
  - Снимается на стороне бэкенда
  - Реализовано через обёртку над методом обращения к БД
  - Позволяет отследить чистое время работы базы данных
- **Время выполнения HTTP-запроса**
  - Снимается на стороне фронтенда

График позволяет наглядно сравнить:
- Реальное время работы БД
- Общее время выполнения запроса

